% ibra :]
\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{uci_proyecto}[2025/10/09 Clase para informes t√©cnicos UCI]

\LoadClass[a4paper,12pt]{report}

% ----------------------------------------------------------
% üì¶ Paquetes b√°sicos
% ----------------------------------------------------------
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[spanish, provide=*]{babel}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{tocloft}
\usepackage{titlesec}
\usepackage{setspace}
\usepackage{booktabs}
\usepackage{float}
\usepackage{caption}
\usepackage{amsmath, amssymb}
\usepackage{natbib}
\usepackage{xparse}
\usepackage{etoolbox}
\usepackage{xstring}
\usepackage{xcolor}

% ----------------------------------------------------------
% üìÑ M√°rgenes y formato general
% ----------------------------------------------------------
\geometry{top=2.5cm,bottom=2.5cm,left=3cm,right=2.5cm}
\onehalfspacing

\DeclareUnicodeCharacter{2248}{\ensuremath{\approx}}
\setlength{\headheight}{15pt}


% ----------------------------------------------------------
% üìå Cabeceras y pies
% ----------------------------------------------------------
\pagestyle{fancy}
\fancyhf{} % limpia cabeceras y pies

% Cabecera derecha: muestra cap√≠tulo o secci√≥n
\fancyhead[R]{\nouppercase{\rightmark}}
% Pie de p√°gina centrado: n√∫mero de p√°gina
\fancyfoot[C]{\thepage}

% Marcadores para cap√≠tulos y secciones
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}}

% Evitar cabecera en portada o p√°ginas especiales
\fancypagestyle{plain}{%
  \fancyhf{}
  \fancyfoot[C]{\thepage}
}

% ----------------------------------------------------------
% üìÑ Formato de t√≠tulos
% ----------------------------------------------------------
\titleformat{\chapter}{\bfseries\huge}{\thechapter.}{1em}{}
\titleformat{\section}{\bfseries\Large}{\thesection.}{1em}{}
\titleformat{\subsection}{\bfseries\large}{\thesubsection.}{1em}{}

\renewcommand{\contentsname}{Tabla de Contenidos}
\renewcommand{\listtablename}{√çndice de Tablas}
\renewcommand{\listfigurename}{√çndice de Figuras}

% ----------------------------------------------------------
% üß© Comando auxiliar para formatear nombres
% ----------------------------------------------------------
\newcommand{\formatNames}[1]{%
  \begingroup
  \IfStrEq{#1}{}{%
    \endgroup
  }{%
    \IfStrEq{#1}{---}{%
      \endgroup
    }{%
      \def\namelist{#1}%
      \def\first{}%
      \renewcommand{\do}[1]{%
        \ifx\first\empty
          \def\first{##1}%
        \else
          \\[-0.2em]\hspace*{3.4cm}##1%
        \fi
      }%
      \docsvlist{\namelist}%
      \first
      \endgroup
    }%
  }%
}

% ----------------------------------------------------------
% üìÑ Comando para la portada
% ----------------------------------------------------------
\newcommand{\portadaUCI}[9]{%
  \begin{titlepage}
  \centering

  % LOGO
  \IfFileExists{img/uci_logo.png}{
    \includegraphics[width=0.35\textwidth]{img/uci_logo.png}\par\vspace{2cm}
  }{
    \vspace{2cm}
    {\Large \textbf{[Logo de la UCI no disponible]}}\par\vspace{2cm}
  }

  % T√çTULO
  {\Large \textbf{#1}}\\[1.5cm]
  {\huge \textbf{#2}}\\[1.5cm]
  \textit{Informe T√©cnico de la asignatura de Proyecto de Investigaci√≥n y Desarrollo}\\[2cm]

  % AUTORES Y TUTORES
  \begin{flushleft}
    \IfStrEq{#3}{}{ }{\textbf{Autor(es):} \formatNames{#3}\\[0.4cm]}
    \IfStrEq{#4}{}{ }{\textbf{Tutor(es):} \formatNames{#4}\\[0.4cm]}
    \IfStrEq{#5}{}{ }{\textbf{Co-tutor:} \formatNames{#5}\\[0.4cm]}
    \IfStrEq{#6}{}{ }{\textbf{Consultante:} \formatNames{#6}\\[0.4cm]}
    \IfStrEq{#7}{}{ }{\textbf{Asesor:} \formatNames{#7}\\[1cm]}
  \end{flushleft}

  \vfill
  {\large La Habana, #8 de #9}\\[0.2cm]
  \textit{‚ÄúA√±o de la Revoluci√≥n‚Äù}
  \end{titlepage}
}

% ----------------------------------------------------------
% üìå Comando para la tabla de contenidos y listas con cabecera
% ----------------------------------------------------------
\newcommand{\CompleteIndex}{%
  % ----- Tabla de Contenidos -----
  \cleardoublepage
  \phantomsection
  \markboth{Tabla de Contenidos}{Tabla de Contenidos} % cabecera
  \renewcommand{\contentsname}{Tabla de Contenidos} % t√≠tulo
  \tableofcontents

  % ----- √çndice de Tablas -----
  \cleardoublepage
  \phantomsection
  \markboth{√çndice de Tablas}{√çndice de Tablas} % cabecera
  \renewcommand{\listtablename}{√çndice de Tablas} % t√≠tulo
  \listoftables

  % ----- √çndice de Figuras -----
  \cleardoublepage
  \phantomsection
  \markboth{√çndice de Figuras}{√çndice de Figuras} % cabecera
  \renewcommand{\listfigurename}{√çndice de Figuras} % t√≠tulo
  \listoffigures
}

% ----------------------------------------------------------
% üìå Comando para cap√≠tulos sin n√∫mero (Introducci√≥n, Conclusiones)
% ----------------------------------------------------------
\newcommand{\introduction}{%
  \cleardoublepage
  \phantomsection
  \addcontentsline{toc}{chapter}{Introducci√≥n}%
  \markboth{Introducci√≥n}{}%
  \chapter*{Introducci√≥n}%
}

\newcommand{\conclusions}{%
  \cleardoublepage
  \phantomsection
  \addcontentsline{toc}{chapter}{Conclusiones}%
  \markboth{Conclusiones}{}%
  \chapter*{Conclusiones}%
}



% ----------------------------------------------------------
% üìå Numeraci√≥n de p√°ginas
% ----------------------------------------------------------
% Preliminares en n√∫meros romanos
\newcommand{\preliminaries}{%
  \pagenumbering{roman}%
  \setcounter{page}{1}%
}

% Cuerpo principal en n√∫meros ar√°bigos a partir de la Introducci√≥n
\newcommand{\mainmatter}{%
  \cleardoublepage
  \pagenumbering{arabic}%
  \setcounter{page}{1}%
}



% ----------------------------------------------------------
% üìå Comando para la p√°gina de Resumen y Abstract 
% ----------------------------------------------------------
\long\def\ResumenAbstract#1#2{%
  \cleardoublepage                % nueva p√°gina impar
  \thispagestyle{plain}           % sin cabecera, solo pie centrado
  \phantomsection                 % ancla para hiperv√≠nculos

  % ----- Resumen -----
  \chapter*{Resumen}              % t√≠tulo del resumen
  \markboth{Resumen}{}            % actualiza la cabecera

  {\large #1}                     % contenido del resumen en espa√±ol

  % ----- Abstract -----
  \chapter*{\textit{Abstract}}    % t√≠tulo en cursiva (igual formato que Resumen)
  \markboth{Abstract}{}            % actualiza la cabecera

  {\large \textit{#2}}            % contenido en cursiva

  \cleardoublepage                 % asegura que la siguiente secci√≥n comience en nueva p√°gina
}




% ----------------------------------------------------------
% üìå Comando para la p√°gina de DATOS DE CONTACTO 
% ----------------------------------------------------------
\long\def\contactInformation#1{%
  \cleardoublepage                % nueva p√°gina impar
  \thispagestyle{plain}           % sin cabecera, solo pie centrado
  \phantomsection                 % ancla para hiperv√≠nculos

  % ----- Resumen -----
  \chapter*{Datos de Contacto}    % t√≠tulo
  \markboth{Datos de Contacto}{}  % actualiza la cabecera

  {\large #1}                     % contenido del resumen en espa√±ol

  \cleardoublepage                 % asegura que la siguiente secci√≥n comience en nueva p√°gina
}


% ----------------------------------------------------------
% üìå Comando para la p√°gina de Recomendaciones
% ----------------------------------------------------------
\long\def\Recommendations#1{%
  \cleardoublepage                % empieza en nueva p√°gina impar
  \phantomsection                 % ancla para hiperv√≠nculos
  \addcontentsline{toc}{chapter}{Recomendaciones}% agrega al √≠ndice
  \markboth{Recomendaciones}{}    % cabecera

  \chapter*{Recomendaciones}      % t√≠tulo sin numerar
  \thispagestyle{plain}           % pie centrado, sin cabecera

  {\large #1}                     % contenido de la secci√≥n

  \cleardoublepage                % deja lista la siguiente secci√≥n
}

% ----------------------------------------------------------
% üìå Comando para la p√°gina de Anexos
% ----------------------------------------------------------
\long\def\Anexes#1{%
  \cleardoublepage
  \phantomsection
  \addcontentsline{toc}{chapter}{Anexos}% agrega al √≠ndice
  \markboth{Anexos}{}             % cabecera

  \chapter*{Anexos}
  \thispagestyle{plain}

  {\large #1}

  \cleardoublepage
}


% ----------------------------------------------------------
% üìå Comando para la p√°gina de OPINI√ìN DEL TUTOR 
% ----------------------------------------------------------
\long\def\TutorsOpinion#1{%
  \cleardoublepage                % nueva p√°gina impar
  \thispagestyle{plain}           % sin cabecera, solo pie centrado
  \phantomsection                 % ancla para hiperv√≠nculos

  % ----- Resumen -----
  \chapter*{Opini√≥n de los Tutores}    % t√≠tulo
  \markboth{Opini√≥n de los Tutores}{}  % actualiza la cabecera

  {\large #1}                     % contenido del resumen en espa√±ol

  \cleardoublepage                 % asegura que la siguiente secci√≥n comience en nueva p√°gina
}



% ----------------------------------------------------------
% üìå Comando para la estructura del cap√≠tulo de desarrollo
% ----------------------------------------------------------

% --- Introducci√≥n del cap√≠tulo (no numerada pero en el √≠ndice) ---
\newcommand{\IntroCap}[2]{%
  \section*{Introducci√≥n}%
  \addcontentsline{toc}{section}{Introducci√≥n}%
  \phantomsection
  \label{intro:#1}%
  #2
  \vspace{0.5cm} % espacio antes del primer ep√≠grafe
}

% --- Ep√≠grafes numerados en romano (tambi√©n en el √≠ndice) ---
\newcounter{epigrafe}[chapter]
\renewcommand{\theepigrafe}{\Roman{epigrafe}}

\newcommand{\Epigrafe}[2]{%
  \refstepcounter{epigrafe}
  \section*{\theepigrafe. #1}%
  \addcontentsline{toc}{section}{\theepigrafe. #1}%
  \phantomsection
  \label{epi:#1}%
  #2
  \vspace{0.5cm}
}


% ----------------------------------------------------------
%  Comando para Referencias bibliograficas
% ----------------------------------------------------------
\long\def\BibliRefer#1{%
  \cleardoublepage
  \phantomsection
  \addcontentsline{toc}{chapter}{Referencias bibliogr√°ficas}% agrega al √≠ndice
  \markboth{Referencias bibliogr√°ficas}{}             % cabecera

  \chapter*{Referencias bibliogr√°ficas}
  \thispagestyle{plain}

  {\large #1}

  \cleardoublepage
}


% ----------------------------------------------------------
% üü• Comando para mostrar estructura de ejemplo (texto en rojo, sin numeraci√≥n)
% ----------------------------------------------------------
\newenvironment{Explain}[2]{%
  \clearpage
  \pagestyle{empty}% üîπ desactiva numeraci√≥n mientras dure el entorno
  \begingroup
  \color{red}
  \noindent\textbf{#1}\\[0.3cm]%
  #2%
  \par
}{%
  \endgroup
  \clearpage
  \pagestyle{fancy}% üîπ restaura numeraci√≥n y cabecera
}



% ----------------------------------------------------------
% üìå Comando para Referencias Bibliogr√°ficas
% ----------------------------------------------------------
\newcommand{\References}{%
  \cleardoublepage
  \phantomsection
  \addcontentsline{toc}{chapter}{Referencias Bibliogr√°ficas}
  \chapter*{Referencias Bibliogr√°ficas}%
  \markboth{Referencias Bibliogr√°ficas}{}%
  \renewcommand{\baselinestretch}{1.15}\selectfont % interlineado 1.15
  \fontsize{11pt}{13pt}\selectfont                 % Arial 11pt
  \bibliographystyle{apalike} % o cualquier estilo APA compatible
  \bibliography{referencias}   % tu archivo .bib
  \cleardoublepage
}
